rule qcreads_paired_r12:
    input:
        r1=lambda wc: config["RAWDATA_PATHS"][(wc.run, wc.lib)][0],
        r2=lambda wc: config["RAWDATA_PATHS"][(wc.run, wc.lib)][0],
    output:
        reads=temp("tmp/reads/qc/{run}~{lib}_r12.fastq.gz"),
        settings="output/stats/adapterremoval/{run}~{lib}_r12.settings",
    resources:
        runtime=120,
        mem_gb=16,
    threads: 12
    log: "tmp/reads/qc/{run}~{lib}_r12.fastq.log",
    params:
        adpfile="rawdata/adapters.txt",# lambda wc: config["tool_settings"]["adapterremoval"][config["RL_QCTYPE"][(wc.run, wc.lib)]]["adapter_file"],
        minqual=20, #lambda wc: config["tool_settings"]["adapterremoval"][config["RL_QCTYPE"][(wc.run, wc.lib)]]["minqual"],
        qualenc=33, #lambda wc: config["tool_settings"]["adapterremoval"][config["RL_QCTYPE"][(wc.run, wc.lib)]]["qualenc"],
        maxqualval=90, #lambda wc: config["tool_settings"]["adapterremoval"][config["RL_QCTYPE"][(wc.run, wc.lib)]]["maxqualval"],
        ziplevel=8, #config.get("tool_settings", {}).get('ziplevel', 6),
    conda: "../envs/reads.yml"
    shell:
        "( AdapterRemoval"
        "   --file1 {input.r1}"
        "   --file2 {input.r2}"
        "   --adapter-list {params.adpfile}"
        "   --combined-output"
        "   --interleaved-output"
        "   --trimns"
        "   --trimqualities"
        "   --trimwindows 10"
        "   --qualitymax {params.maxqualval}"
        "   --qualitybase {params.qualenc}"
        "   --qualitybase-output 33"
        "   --minquality {params.minqual}"
        "   --threads {threads}"
        "   --settings {output.settings}"
        "   --output1 >(pigz -{params.ziplevel} -p {threads} >{output.reads})"
        ") >{log} 2>&1"
